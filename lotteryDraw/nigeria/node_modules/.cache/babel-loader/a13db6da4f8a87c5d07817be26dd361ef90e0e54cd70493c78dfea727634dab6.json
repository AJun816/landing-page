{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\nimport { reactive, ref, onMounted, onUnmounted, watch } from 'vue';\n\n// 定义props，完全基于传入的配置\n\nexport default {\n  __name: 'ProgressCountdown',\n  props: {\n    config: {\n      type: Object,\n      required: true,\n      validator: value => {\n        // 简单验证配置是否包含必要字段\n        return 'label' in value && 'totalDuration' in value && 'labels' in value;\n      }\n    }\n  },\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const props = __props;\n\n    // 提取时间单位的键名，使组件更灵活\n    const timeKeys = Object.keys(props.config.labels);\n\n    // 状态管理\n    const time = reactive(\n    // 初始化时间对象，根据配置的时间单位\n    timeKeys.reduce((acc, key) => {\n      acc[key] = key === 'millisecond' ? '000' : '00';\n      return acc;\n    }, {}));\n    const progress = ref(100);\n    const timer = ref(null);\n    const isEnded = ref(false); // 倒计时是否结束\n    const isLowTime = ref(false); // 是否进入“最后1分钟”紧张期\n    const isNumberChanged = ref(\n    // 初始化数字变化标记\n    timeKeys.reduce((acc, key) => {\n      acc[key] = false;\n      return acc;\n    }, {}));\n\n    // 记录上一次时间，判断是否变化（触发动画）\n    const lastTime = ref({\n      ...time\n    });\n\n    // 倒计时核心逻辑\n    const startCountdown = () => {\n      const endTime = Date.now() + props.config.totalDuration;\n      timer.value = setInterval(() => {\n        const remaining = Math.max(0, endTime - Date.now());\n        const newTime = {};\n\n        // 根据配置的时间单位计算对应的值\n        if ('minute' in time) {\n          newTime.minute = String(Math.floor(remaining / 60000)).padStart(2, '0');\n        }\n        if ('second' in time) {\n          newTime.second = String(Math.floor(remaining / 1000) % 60).padStart(2, '0');\n        }\n        if ('millisecond' in time) {\n          newTime.millisecond = String(remaining % 1000).padStart(3, '0');\n        }\n\n        // 标记变化的数字（触发动画）\n        timeKeys.forEach(key => {\n          if (newTime[key] !== lastTime.value[key]) {\n            isNumberChanged.value[key] = true;\n            lastTime.value[key] = newTime[key];\n          }\n        });\n\n        // 更新时间和进度\n        Object.assign(time, newTime);\n        progress.value = remaining / props.config.totalDuration * 100;\n\n        // 判定“紧张期”（最后1分钟）\n        isLowTime.value = remaining < 60000;\n\n        // 倒计时结束：清理定时器+更新状态\n        if (remaining <= 0) {\n          clearInterval(timer.value);\n          isEnded.value = true;\n        }\n      }, 10); // 10ms间隔：毫秒数更精准，提升真实感\n    };\n\n    // 生命周期：挂载时启动，卸载时清理\n    onMounted(startCountdown);\n    onUnmounted(() => clearInterval(timer.value));\n\n    // 监听结束状态：结束时可添加额外逻辑\n    watch(isEnded, ended => {\n      if (ended) {\n        // 可扩展：结束时的提示逻辑\n        console.log(\"活动结束\");\n      }\n    });\n    const __returned__ = {\n      props,\n      timeKeys,\n      time,\n      progress,\n      timer,\n      isEnded,\n      isLowTime,\n      isNumberChanged,\n      lastTime,\n      startCountdown,\n      reactive,\n      ref,\n      onMounted,\n      onUnmounted,\n      watch\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["reactive","ref","onMounted","onUnmounted","watch","props","__props","timeKeys","Object","keys","config","labels","time","reduce","acc","key","progress","timer","isEnded","isLowTime","isNumberChanged","lastTime","startCountdown","endTime","Date","now","totalDuration","value","setInterval","remaining","Math","max","newTime","minute","String","floor","padStart","second","millisecond","forEach","assign","clearInterval","ended","console","log"],"sources":["/Users/ajun/projects/github/landing-page/lotteryDraw/nigeria/src/components/countdown/ProgressCountdown.vue"],"sourcesContent":["<template>\n  <!-- 主容器：增加阴影/圆角，提升质感 -->\n  <div class=\"w-full max-w-lg mx-auto  rounded-xl \">\n    <!-- 顶部：限时标签 + 标题（强化商业属性） -->\n    <div class=\"relative bg-gray-900 px-6 py-4\">\n\n      <!-- 标题：淡入动画，快结束时添加抖动 -->\n      <h1 \n        class=\"text-xl font-bold text-center text-white transition-all duration-300\"\n        :class=\"{ 'animate-shake': isLowTime }\"\n      >\n        {{ config.label }}\n      </h1>\n    </div>\n\n    <!-- 进度条区域：流光+渐变，快结束时变红/脉冲 -->\n    <div class=\"px-6 py-5 relative\">\n      <div class=\"relative h-8 bg-gray-200 rounded-full overflow-hidden shadow-inner\">\n        <!-- 主进度条：渐变+过渡 -->\n        <div \n          class=\"absolute top-0 left-0 h-full transition-all duration-150 ease-linear\"\n          :class=\"{ \n            'bg-gradient-to-r from-orange-500 to-red-600': !isLowTime, \n            'bg-gradient-to-r from-red-600 to-red-500 animate-pulse': isLowTime \n          }\"\n          :style=\"{ width: progress + '%' }\"\n        >\n          <!-- 流光特效（提升质感） -->\n          <div class=\"absolute top-0 left-0 h-full w-1/3 bg-white/20 transform skew-x-12 animate-flow\"></div>\n        </div>\n      </div>\n    </div>\n\n    <!-- 倒计时数字：大字体+变化动画，快结束时变红 -->\n    <div class=\"px-6 py-2 flex justify-center items-center space-x-4 md:space-x-8\">\n      <div \n        v-for=\"(key, index) in timeKeys\" \n        :key=\"index\"\n        class=\"flex flex-col items-center\"\n      >\n        <!-- 数字：大字体+文字阴影，变化时放大 -->\n        <span \n          class=\"text-4xl md:text-5xl font-extrabold transition-all duration-200\"\n          :class=\"{ \n            'text-gray-800': !isLowTime, \n            'text-red-600': isLowTime,\n            'animate-number-pulse': isNumberChanged[key] \n          }\"\n          @transitionend=\"() => (isNumberChanged[key] = false)\"\n        >\n          {{ time[key] }}\n        </span>\n        <!-- 单位：小字体+灰色，快结束时同步变红 -->\n        <span \n          class=\"mt-1 text-sm font-medium\"\n          :class=\"{ 'text-gray-500': !isLowTime, 'text-red-500': isLowTime }\"\n        >\n          {{ config.labels[key] }}\n        </span>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { reactive, ref, onMounted, onUnmounted, watch } from 'vue'\n\n// 定义props，完全基于传入的配置\nconst props = defineProps({\n  config: {\n    type: Object,\n    required: true,\n    validator: (value) => {\n      // 简单验证配置是否包含必要字段\n      return 'label' in value && 'totalDuration' in value && 'labels' in value\n    }\n  }\n})\n\n// 提取时间单位的键名，使组件更灵活\nconst timeKeys = Object.keys(props.config.labels)\n\n// 状态管理\nconst time = reactive(\n  // 初始化时间对象，根据配置的时间单位\n  timeKeys.reduce((acc, key) => {\n    acc[key] = key === 'millisecond' ? '000' : '00'\n    return acc\n  }, {})\n)\n\nconst progress = ref(100)\nconst timer = ref(null)\nconst isEnded = ref(false) // 倒计时是否结束\nconst isLowTime = ref(false) // 是否进入“最后1分钟”紧张期\nconst isNumberChanged = ref(\n  // 初始化数字变化标记\n  timeKeys.reduce((acc, key) => {\n    acc[key] = false\n    return acc\n  }, {})\n)\n\n// 记录上一次时间，判断是否变化（触发动画）\nconst lastTime = ref({ ...time })\n\n// 倒计时核心逻辑\nconst startCountdown = () => {\n  const endTime = Date.now() + props.config.totalDuration\n\n  timer.value = setInterval(() => {\n    const remaining = Math.max(0, endTime - Date.now())\n    const newTime = {}\n    \n    // 根据配置的时间单位计算对应的值\n    if ('minute' in time) {\n      newTime.minute = String(Math.floor(remaining / 60000)).padStart(2, '0')\n    }\n    if ('second' in time) {\n      newTime.second = String(Math.floor(remaining / 1000) % 60).padStart(2, '0')\n    }\n    if ('millisecond' in time) {\n      newTime.millisecond = String(remaining % 1000).padStart(3, '0')\n    }\n\n    // 标记变化的数字（触发动画）\n    timeKeys.forEach(key => {\n      if (newTime[key] !== lastTime.value[key]) {\n        isNumberChanged.value[key] = true\n        lastTime.value[key] = newTime[key]\n      }\n    })\n\n    // 更新时间和进度\n    Object.assign(time, newTime)\n    progress.value = (remaining / props.config.totalDuration) * 100\n\n    // 判定“紧张期”（最后1分钟）\n    isLowTime.value = remaining < 60000\n\n    // 倒计时结束：清理定时器+更新状态\n    if (remaining <= 0) {\n      clearInterval(timer.value)\n      isEnded.value = true\n    }\n  }, 10) // 10ms间隔：毫秒数更精准，提升真实感\n}\n\n// 生命周期：挂载时启动，卸载时清理\nonMounted(startCountdown)\nonUnmounted(() => clearInterval(timer.value))\n\n// 监听结束状态：结束时可添加额外逻辑\nwatch(isEnded, (ended) => {\n  if (ended) {\n    // 可扩展：结束时的提示逻辑\n    console.log(\"活动结束\")\n  }\n})\n</script>\n\n<style scoped>\n/* 自定义动画：进度条流光效果 */\n@keyframes flow {\n  0% { transform: translateX(-100%) skew-x-12; }\n  100% { transform: translateX(300%) skew-x-12; }\n}\n\n/* 自定义动画：数字变化时的放大脉冲 */\n@keyframes numberPulse {\n  0% { transform: scale(1); }\n  50% { transform: scale(1.1); }\n  100% { transform: scale(1); }\n}\n\n/* 自定义动画：快结束时标题抖动 */\n@keyframes shake {\n  0%, 100% { transform: translateX(0); }\n  25% { transform: translateX(-2px); }\n  50% { transform: translateX(2px); }\n  75% { transform: translateX(-2px); }\n}\n\n/* 动画类绑定 */\n.animate-flow {\n  animation: flow 2s infinite linear;\n}\n.animate-number-pulse {\n  animation: numberPulse 0.3s ease-in-out;\n}\n.animate-shake {\n  animation: shake 0.5s infinite;\n}\n\n/* 优化移动端适配 */\n@media (max-width: 480px) {\n  .text-4xl { font-size: 2.5rem; }\n  .text-5xl { font-size: 3rem; }\n  .space-x-8 { gap: 1rem; }\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}