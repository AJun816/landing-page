# HTTP服务器（80端口）：仅用于重定向到HTTPS
server {
    listen 80;
    server_name _;  # 匹配所有域名

    # 所有HTTP请求强制跳转到HTTPS
    return 301 https://$host$request_uri;
}

# HTTPS服务器（443端口）：核心配置
server {
    listen 443 ssl;
    server_name _;  # 匹配所有域名（若有特定域名可替换为实际域名，如music.htgjai.com）

    # SSL证书配置（引用容器内的证书路径，对应步骤1的挂载路径）
    ssl_certificate /etc/nginx/ssl/htgjai_com.crt;         # 公钥证书
    ssl_certificate_key /etc/nginx/ssl/htgjai.key;         # 私钥
    ssl_trusted_certificate /etc/nginx/ssl/htgjai_com.ca-bundle;  # 证书链（可选，增强兼容性）

    # SSL安全优化配置（推荐添加）
    ssl_protocols TLSv1.2 TLSv1.3;  # 仅支持安全的TLS协议
    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers on;  # 优先使用服务器定义的加密套件
    ssl_session_cache shared:SSL:10m;  # 启用SSL会话缓存
    ssl_session_timeout 1d;  # 会话超时时间

    # 核心：所有请求优先匹配文件，否则回退到index.html（与原HTTP逻辑一致）
    location / {
        root /usr/share/nginx/html/src;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    # 静态资源缓存（背景图、JS、CSS等）
    location /assets {
        alias /usr/share/nginx/html/assets;
        expires 7d;
        add_header Cache-Control "public";
    }
}